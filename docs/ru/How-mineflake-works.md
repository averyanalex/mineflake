# Как работает mineflake

[<- Назад](./README.md)

## NixOS

Mineflake работает на NixOS, которая дает нам надежную систему и атомарные обновления с простым откатом, и ее менеджер пакетов Nix,
который позволяет создавать полностью воспроизводимые пакеты. Nix, когда он загружает зависимости (плагины, другие пакеты, необходимые
для сборки плагинов) и собирает результат, криптографически хэширует их и помещает в `/nix/store`, свое хранилище со всеми пакетами.

Когда мы начнем процесс пересборки, Nix создаст предварительно настроенные конфигурации и загрузит серверные зависимости.

## Контейнеры

После Nix создаёт контйнеры, контейнеры - изолированные легковесные виртуальные машины. Мы используем контейнеры не для изоляции
зависимостей (это Nix обеспечивает сам по себе), а для безопасности - порты ограничены, интернет может быть отключен, дополнительный
уровень абстракции для вирусов и хакеров. Контейнер содержит другую систему NixOS, но с нашим `/nix/store`.

## Скрипт загрузки

После запуска контейнера запускается cкрипт загрузки. Его цель проста - подготовить место для запуска нашего сервера. Он создает папки,
аккуратно помещает конфиги в свои папки, заменяет в них секреты, создаёт ссылки из `/nix/store` на наши плагины и запускает сервер.
